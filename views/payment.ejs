<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Payment</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel='stylesheet' type='text/css' href="/css/signin.css">
</head>

<body class="text-center" style="display: block">
    <%- include("user-nav") -%>
    <main role="main">
        <div class="container" style="margin-top: 50px; margin-bottom: 50px; padding-bottom: 50px">
            <h1 class="mt-5" style="margin-top: 50px">Payment of Service <%= results.service_no %></h1>
            <div class="card" style="margin: 50px auto 50px auto; max-width: 700px;">
                <div class="card-body" style="padding-top: 20px; text-align: left;">
                    <dl class="row">
                        <dd class="col-sm-5">Service Number</dt>
                        <dd class="col-sm-7"><%= results.service_no %></dd>

                        <dd class="col-sm-5">Customer Type</dt>
                        <dd class="col-sm-7"><%= results.cust_type == 'I' ? 'Individual' : 'Corporate'%></dd>

                        <dt class="col-sm-12" style="margin-top: 15px; margin-bottom: 5px;">Vehicle</dt>

                        <dd class="col-sm-5">Make/Model/Year</dt>
                        <dd class="col-sm-7"><%= results.make + results.model + results.year %></dd>
                        <dd class="col-sm-5">Vin of the Vehicle</dt>
                        <dd class="col-sm-7"><%= results.vin %></dd>
                        <dd class="col-sm-5">License Plate Number</dt>
                        <dd class="col-sm-7"><%= results.license_plate_no %></dd>
                        <dd class="col-sm-5">Vehicle Class</dt>
                        <dd class="col-sm-7"><%= results.class_name %></dd>

                        <dt class="col-sm-12" style="margin-top: 15px; margin-bottom: 5px;">Rental Info</dt>

                        <dd class="col-sm-5">Daily Rate of Service</dt>
                        <dd class="col-sm-7"><%= results.rental_rate %></dd>
                        <dd class="col-sm-5">Odometer Limit</dt>
                        <dd class="col-sm-7"><%= results.odometer_limit %></dd>
                        <dd class="col-sm-5">Over Mileage Fee</dt>
                        <dd class="col-sm-7"><%= results.mileage_fee %></dd>
                        <dd class="col-sm-5">Your Actual Odometer</dt>
                        <dd class="col-sm-7"><%= results.odometer %></dd>
                        <dd class="col-sm-5">Days of Renting</dt>
                        <dd class="col-sm-7"><%= results.days %></dd>

                        <dt class="col-sm-12" style="margin-top: 15px; margin-bottom: 5px;">Payment Info</dt>

                        <% if (results.cust_type == 'I') { %>
                        <dd class="col-sm-5">Coupon Used</dt>
                            <% if (results.coupon_no != 10000) { %>
                        <dd class="col-sm-7"><%= (results.coupon_discount * 100) + "% off"%></dd>
                        <% } else { %>
                        <dd class="col-sm-7">Not Applicated</dd>
                        <% }%>
                        <% } else { %>
                        <dd class="col-sm-5">Company Name</dt>
                        <dd class="col-sm-7"><%= results.cname%></dd>
                        <dd class="col-sm-5">Company Discount</dt>
                        <dd class="col-sm-7"><%= results.discount * 100 + "% off"%></dd>
                        <% } %>
                        <dd class="col-sm-5">Fee Amount</dt>
                        <dd class="col-sm-7">$ <%= results.invoice_amount%></dd>
                        <dd class="col-sm-5">Remaining Amount</dt>
                        <dd class="col-sm-7">$ <%= results.invoice_remain_amount%></dd>

                        <ul class="nav nav-tabs" id="myTab" role="tablist" style="width: 100%; margin-top: 20px;">
                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#credit" role="tab"
                                    aria-controls="home" aria-selected="true">Credit Card</a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#debit" role="tab"
                                    aria-controls="profile" aria-selected="false">Debit Card</a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#gift" role="tab"
                                    aria-controls="contact" aria-selected="false">Gift Card</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent" style="width: 100%;">
                            <div class="tab-pane fade show active" id="credit" role="tabpanel"
                                aria-labelledby="home-tab">
                                <form name="creditForm" method="post" onsubmit="return checkInp()"
                                    style="margin: 20px 20px 0 20px;">
                                    <div class="form-group row">
                                        <label for="amount" class="col-sm-3 col-form-label">Amount</label>
                                        <div class="col-sm-8">
                                            <input name="payment_amount" type="text" class="form-control"
                                                id="payment_amount" required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="card_no" class="col-sm-3 col-form-label">Card Number</label>
                                        <div class="col-sm-8">
                                            <input name="card_no" type="text" class="form-control" id="card_no"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="expiry" class="col-sm-3 col-form-label">Expiry</label>
                                        <div class="col-sm-3">
                                            <input name="expiry" type="text" class="form-control" id="expiry"
                                                maxlength="5" placeholder="MM/YY" required>
                                        </div>

                                        <label for="cvc" class="col-sm-2 col-form-label">CVC</label>
                                        <div class="col-sm-3">
                                            <input name="cvc" type="text" class="form-control" id="cvc" maxlength="3"
                                                required>
                                        </div>
                                    </div>
                                    <input hidden name="payment_method" value="C">
                                    <input hidden name="invoice_no" value=<%= results.invoice_no%>>
                                    <input hidden name="invoice_remain_amount"
                                        value=<%= results.invoice_remain_amount%>>
                                    <button type="submit" class="btn btn-primary mb-2">Pay</button>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="debit" role="tabpanel" aria-labelledby="profile-tab">
                                <form name="debitForm" method="post" onsubmit="return checkInp()"
                                    style="margin: 20px 20px 0 20px;">
                                    <div class="form-group row">
                                        <label for="amount" class="col-sm-3 col-form-label">Amount</label>
                                        <div class="col-sm-8">
                                            <input name="payment_amount" type="text" class="form-control"
                                                id="payment_amount" required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="card_no" class="col-sm-3 col-form-label">Card Number</label>
                                        <div class="col-sm-8">
                                            <input name="card_no" type="text" class="form-control" id="card_no"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="expiry" class="col-sm-3 col-form-label">Expiry</label>
                                        <div class="col-sm-3">
                                            <input name="expiry" type="text" class="form-control" id="expiry"
                                                maxlength="5" placeholder="MM/YY" required>
                                        </div>

                                        <label for="cvc" class="col-sm-2 col-form-label">CVC</label>
                                        <div class="col-sm-3">
                                            <input name="cvc" type="text" class="form-control" id="cvc" required
                                                maxlength="3">
                                        </div>
                                    </div>
                                    <input hidden name="payment_method" value="D">
                                    <input hidden name="invoice_no" value=<%= results.invoice_no%>>
                                    <input hidden name="invoice_remain_amount"
                                        value=<%= results.invoice_remain_amount%>>
                                    <button type="submit" class="btn btn-primary mb-2">Pay</button>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="gift" role="tabpanel" aria-labelledby="contact-tab">
                                <form name="giftForm" method="post" onsubmit="return checkInp()"
                                    style="margin: 20px 20px 0 20px;">
                                    <div class="form-group row">
                                        <label for="card_no" class="col-sm-3 col-form-label">Gift Card Number</label>
                                        <div class="col-sm-8">
                                            <input name="card_no" type="text" class="form-control" id="card_no"
                                                required>
                                        </div>
                                    </div>
                                    <input hidden name="payment_method" value="G">
                                    <input hidden name="invoice_no" value=<%= results.invoice_no%>>
                                    <input hidden name="invoice_remain_amount"
                                        value=<%= results.invoice_remain_amount%>>
                                    <button type="submit" class="btn btn-primary mb-2">Pay</button>
                                </form>
                            </div>
                        </div>
                    </dl>
                </div>
            </div>
        </div>
    </main>
    <script>
        function checkInp() {

            let card_no_c = document.forms["creditForm"]["card_no"].value;
            let card_no_d = document.forms["debitForm"]["card_no"].value;
            let card_no_g = document.forms["giftForm"]["card_no"].value;
            let amount_c = document.forms["creditForm"]["payment_amount"].value;
            let amount_d = document.forms["debitForm"]["payment_amount"].value;
            let expiry_c = document.forms["creditForm"]["expiry"].value;
            let expiry_d = document.forms["debitForm"]["expiry"].value;
            let cvc_c = document.forms["creditForm"]["cvc"].value;
            let cvc_d = document.forms["debitForm"]["cvc"].value;

            if (isNaN(card_no_c) || isNaN(card_no_d) || isNaN(card_no_g)) {
                alert("Must input numbers in card number.");
                return false;
            }

            if (isNaN(amount_c) || isNaN(amount_d)) {
                alert("Must input numbers in amount.");
                return false;
            }

            if (amount_c > <%= results.invoice_remain_amount %> || amount_d > <%= results.invoice_remain_amount %>
                ) {
                alert("Payment amount can not be larger than remaining fee.");
                return false;
            }

            if (isNaN(cvc_c) || isNaN(cvc_d)) {
                alert("Must input numbers in cvc.");
                return false;
            }
        }
    </script>


    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
    </script>
</body>

</html>